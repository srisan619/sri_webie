{%extends "users/base.html" %}

{%block content%}
    <h4>Family Savings - Audit Logs</h4>
    <form method="get" class="row g-3 mb-3">
        <div class="col-md-3">
            <label for="user">User</label>
            <select name="user" id="user" class="form-select">
                <option value="">All</option>
                {%for u in users%}
                    <option value="{{u.id}}" {% if selected_user == u.id|stringformat:"s" %}selected{%endif%}>
                        {{u.username}}
                    </option>
                {%endfor%}
            </select>
        </div>

        <div class="col-md-3">
            <label for="month">Month</label>
            <select name="month" id="month" class="form-select">
                <option value="">All</option>
                {% for month_no, month_name in months %}
                    <option value="{{month_no}}" {%if selected_month == month_no|stringformat:"s" %}selected{%endif%}>
                        {{month_name}}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-3">
            <label for="year">Year</label>
            <input type="number" name="year" class="form-control" placeholder="YYYY" value="{{selected_year}}">
        </div>

        <div class="col-md-3 d-flex">
            <button class="btn btn-primary w-100">Filter</button>
        </div>
    </form>
    <table class="table table-bordered table-striped mt-3">
        <thead class="table-dark">
            <tr>
                <th>Changed By</th>
                <th>Affected User</th>
                <th>Month</th>
                <th>Year</th>
                <th>Old Amount</th>
                <th>New Amount</th>
                <th>Changed At</th>
            </tr>
        </thead>

        <tbody>
            {% for log in logs %}
                <tr>
                    <td>{{log.changed_by.username}}</td>
                    <td>{{log.affected_by.username}}</td>
                    <td>{{log.month}}</td>
                    <td>{{log.year}}</td>
                    <td class="text-danger">{{log.old_amount}}</td>
                    <td class="text-success">{{log.new_amount}}</td>
                    <td>{{log.changed_at|date:"Y-m-d"}}</td>
                </tr>
                {%empty%}
                <tr>
                    <td colspan="7" class="text-center text-muted">
                        No audit records found
                    </td>
                </tr>
            {%endfor%}
        </tbody>
    </table>
{%endblock%}